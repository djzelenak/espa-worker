image: docker:19.03.1

variables:
  DOCKER_TLS_CERTDIR: ""
  DOCKER_HOST: tcp://docker:2375
  DOCKER_DRIVER: overlay2
  GIT_SSL_NO_VERIFY: "1"

services:
  - docker:19.03.1-dind

before_script:
  - apk add make git

docker_base:
  script:
    - make build_base
    - make test_base
    - make deploy_base
  only:
    changes:
      - base/Dockerfile.centos7
      - Makefile
  tags:
    - docker
    - eros
    - lsrd

docker_external:
  script:
    - make build_external
    - make test_external
    - make deploy_external
  only:
    changes:
      - external/Dockerfile.centos7
      - Makefile
  tags:
    - docker
    - eros
    - lsrd
